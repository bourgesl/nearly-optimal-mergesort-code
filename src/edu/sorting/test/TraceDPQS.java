/*******************************************************************************
 * JMMC project ( http://www.jmmc.fr ) - Copyright (C) CNRS.
 ******************************************************************************/
package edu.sorting.test;

import edu.sorting.DualPivotQuickSort2011;
import edu.sorting.DualPivotQuicksort20210424;
import edu.sorting.perf.IntArrayTweaker;
import edu.sorting.perf.ParamIntArrayBuilder;
import java.util.Arrays;

/**
 *
 * @author bourgesl
 */
public class TraceDPQS {

    private final static int M = 1000000;
    private final static int N = 1;

    private final static int SUBSIZE = 1;

    public static void main(String[] args) {
        /*
DITHER____:SHUFFLE stats (%): [1: µ=29.021154 σ=NaN rms=NaN min=29.021154 max=29.021154]
        
data[0-512]: [3, 6, 9, 12, 15, 13, 16, 19, 22, 25, 23, 26, 29, 32, 35, 33, 36, 39, 42, 45, 43, 46, 49, 52, 55, 53, 56, 59, 62, 65, 63, 66, 69, 72, 75, 73, 76, 79, 82, 85, 83, 86, 89, 92, 95, 93, 96, 99, 102, 105, 103, 106, 109, 112, 115, 113, 116, 119, 122, 125, 123, 126, 129, 132, 135, 133, 136, 139, 142, 145, 143, 146, 149, 152, 155, 153, 156, 159, 162, 165, 163, 166, 169, 172, 175, 173, 176, 179, 182, 185, 183, 186, 189, 192, 195, 193, 196, 199, 202, 205, 203, 206, 209, 212, 215, 213, 216, 219, 222, 225, 223, 226, 229, 232, 235, 233, 236, 239, 242, 245, 243, 246, 249, 252, 255, 253, 256, 259, 262, 265, 263, 266, 269, 272, 275, 273, 276, 279, 282, 285, 283, 286, 289, 292, 295, 293, 296, 299, 302, 305, 303, 306, 309, 312, 315, 313, 316, 319, 322, 325, 323, 326, 329, 332, 335, 333, 336, 339, 342, 345, 343, 346, 349, 352, 355, 353, 356, 359, 362, 365, 363, 366, 369, 372, 375, 373, 376, 379, 382, 385, 383, 386, 389, 392, 395, 393, 396, 399, 402, 405, 403, 406, 409, 412, 415, 413, 416, 419, 422, 425, 423, 426, 429, 432, 435, 433, 436, 439, 442, 445, 443, 446, 449, 452, 455, 453, 456, 459, 462, 465, 463, 466, 469, 472, 475, 473, 476, 479, 482, 485, 483, 486, 489, 492, 495, 493, 496, 499, 502, 505, 503, 506, 509, 512, 515, 513, 516, 519, 522, 525, 523, 526, 529, 532, 535, 533, 536, 539, 542, 545, 543, 546, 549, 552, 555, 553, 556, 559, 562, 565, 563, 566, 569, 572, 575, 573, 576, 579, 582, 585, 583, 586, 589, 592, 595, 593, 596, 599, 602, 605, 603, 606, 609, 612, 615, 613, 616, 619, 622, 625, 623, 626, 629, 632, 635, 633, 636, 639, 642, 645, 643, 646, 649, 652, 655, 653, 656, 659, 662, 665, 663, 666, 669, 672, 675, 673, 676, 679, 682, 685, 683, 686, 689, 692, 695, 693, 696, 699, 702, 705, 703, 706, 709, 712, 715, 713, 716, 719, 722, 725, 723, 726, 729, 732, 735, 733, 736, 739, 742, 745, 743, 746, 749, 752, 755, 753, 756, 759, 762, 765, 763, 766, 769, 772, 775, 773, 776, 779, 782, 785, 783, 786, 789, 792, 795, 793, 796, 799, 802, 805, 803, 806, 809, 812, 815, 813, 816, 819, 822, 825, 823, 826, 829, 832, 835, 833, 836, 839, 842, 845, 843, 846, 849, 852, 855, 853, 856, 859, 862, 865, 863, 866, 869, 872, 875, 873, 876, 879, 882, 885, 883, 886, 889, 892, 895, 893, 896, 899, 902, 905, 903, 906, 909, 912, 915, 913, 916, 919, 922, 925, 923, 926, 929, 932, 935, 933, 936, 939, 942, 945, 943, 946, 949, 952, 955, 953, 956, 959, 962, 965, 963, 966, 969, 972, 975, 973, 976, 979, 982, 985, 983, 986, 989, 992, 995, 993, 996, 999, 1002, 1005, 1003, 1006, 1009, 1012, 1015, 1013, 1016, 1019, 1022, 1025, 1023, 1026]
data[-100:0]: [1999803, 1999806, 1999809, 1999812, 1999815, 1999813, 1999816, 1999819, 1999822, 1999825, 1999823, 1999826, 1999829, 1999832, 1999835, 1999833, 1999836, 1999839, 1999842, 1999845, 1999843, 1999846, 1999849, 1999852, 1999855, 1999853, 1999856, 1999859, 1999862, 1999865, 1999863, 1999866, 1999869, 1999872, 1999875, 1999873, 1999876, 1999879, 1999882, 1999885, 1999883, 1999886, 1999889, 1999892, 1999895, 1999893, 1999896, 1999899, 1999902, 1999905, 1999903, 1999906, 1999909, 1999912, 1999915, 1999913, 1999916, 1999919, 1999922, 1999925, 1999923, 1999926, 1999929, 1999932, 1999935, 1999933, 1999936, 1999939, 1999942, 1999945, 1999943, 1999946, 1999949, 1999952, 1999955, 1999953, 1999956, 1999959, 1999962, 1999965, 1999963, 1999966, 1999969, 1999972, 1999975, 1999973, 1999976, 1999979, 1999982, 1999985, 1999983, 1999986, 1999989, 1999992, 1999995, 1999993, 1999996, 1999999, 2000002, 2000005]
        
Test[SHUFFLE | DITHER____ | DPQS_24] M=1000000----------------------------------------------------------
DPQSsort[1000000] bits = 0 in [0 - 1000000]
tryMergeRuns[1000000] in [0 - 1000000]
Challenge: 
1: i[375003] => [750012]
2: i[437501] => [875006]
3: i[499999] => [1000005]
4: i[562497] => [1124999]
5: i[624996] => [1249996]
5-1: d = [499984]
1-2: d = [124994]
2-3: d = [124999]
3-4: d = [124994]
4-5: d = [124997]
radixSort[1000000] in [0 - 1000000]

Radix is not best in this situation         !
        */
        
        test(ParamIntArrayBuilder.SHUFFLE, IntArrayTweaker.DITHER____, Impl.DPQS_24);
    }

    public static void test(ParamIntArrayBuilder iab, IntArrayTweaker iat, Impl impl) {
        final int[] input = new int[M];
        final int[] proto = new int[M];

        // Get new distribution sample:
        iab.build(input, SUBSIZE);

        // Reset tweaker to have sample initial conditions (seed):
        ParamIntArrayBuilder.reset();

        // tweak sample:
        iat.tweak(input, proto);

        final int[] data = proto;
        // copy
        final int[] copy = Arrays.copyOf(data, M);

        if (true) {
            System.out.println("data[0-512]: " + Arrays.toString(Arrays.copyOfRange(data, 0, 512)));
            System.out.println("data[-100:0]: " + Arrays.toString(Arrays.copyOfRange(data, M - 100, M)));
        }

        System.out.println("Test[" + iab + " | " + iat + " | " + impl + "] M=" + M + "----------------------------------------------------------");
        System.arraycopy(data, 0, copy, 0, copy.length);
        impl.sort(data);
        Arrays.sort(copy);

        if (!Arrays.equals(data, copy)) {
            for (int j = 0; j < M; j++) {
                if (data[j] != copy[j]) {
                    System.out.println("Mismatch[" + j + "]: " + data[j] + " != " + copy[j]);
                }
            }
            System.out.flush();
            throw new IllegalStateException("Bad sort : " + impl);
        }
    }

    enum Impl {

        DPQS_24 {
            @Override
            void sort(int[] data) {
                DualPivotQuicksort20210424.INSTANCE.sort(data);
            }
        },
        DPQS_11 {
            @Override
            void sort(int[] data) {
                DualPivotQuickSort2011.INSTANCE.sort(data);
            }
        };

        abstract void sort(int[] data);
    }
}
